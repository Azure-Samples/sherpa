<!--
  Rate limiting policy for MCP servers
  Limits by MCP Session ID to prevent abuse
-->
<policies>
  <inbound>
    <base />
    <!-- Extract MCP session ID from headers -->
    <set-variable name="mcp-session-id" value="@(context.Request.Headers.GetValueOrDefault("X-MCP-Session-Id", "unknown"))" />
    <!-- Rate limit by session: 100 requests per minute -->
    <rate-limit-by-key calls="100" renewal-period="60" counter-key="@((string)context.Variables["mcp-session-id"])" />
    <!-- Quota limit by session: 1000 requests per hour -->
    <quota-by-key calls="1000" renewal-period="3600" counter-key="@((string)context.Variables["mcp-session-id"])" />
  </inbound>
  <backend>
    <base />
  </backend>
  <outbound>
    <base />
  </outbound>
  <on-error>
    <base />
  </on-error>
</policies>
